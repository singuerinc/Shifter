var Shifter;Shifter=function(){var Shifter=function(){return this._currentPath="",this._paths=[],this};return Shifter.prototype={get currentPath(){return this._currentPath}},Shifter.prototype.onShift,Shifter.prototype.match=function(pattern,view){if("string"!=typeof pattern)throw new Error('"pattern" must be a string');if("function"!=typeof view.transitionIn||"function"!=typeof view.transitionOut)throw new Error("Your view doesn't implement transitionIn or transitionOut function.");var p=new Shifter.Matcher(pattern,view);return this._paths.push(p),p},Shifter.prototype.shift=function(path){return path=path.replace(/^#[!]?[\/]?/,""),this._exec(path),this},Shifter.prototype._exec=function(pattern){for(var l=this._paths.length,show_views=[],hide_views=[],i=0;l>i;i++){var path=this._paths[i];path.has(pattern)&&-1===show_views.indexOf(path._view)&&!path._view.__shifter_show__?show_views.push(path._view):!path.has(pattern)&&-1===hide_views.indexOf(path._view)&&path._view.__shifter_show__&&hide_views.push(path._view)}for(var j=0,jl=show_views.length;jl>j;j++){var sv=show_views[j];sv.hasOwnProperty("__shifter_init__")||"function"!=typeof sv.init?sv.transitionIn(function(){this.__shifter_show__=!0}.bind(sv)):sv.init(function(){this.__shifter_init__=!0,this.transitionIn(function(){this.__shifter_show__=!0}.bind(this))}.bind(sv))}for(var k=0,kl=hide_views.length;kl>k;k++){var sh=hide_views[k];sh.transitionOut(function(){this.__shifter_show__=!1}.bind(sh))}show_views.length>0&&(this._currentPath=pattern,"function"==typeof this.onShift&&this.onShift(this._currentPath))},Shifter.Matcher=function(){var optionalParam=/\((.*?)\)/g,namedParam=/(\(\?)?:\w+/g,splatParam=/\*/g,escapeRegExp=/[\-{}\[\]+?.,\\\^$|#\s]/g,_routeToRegExp=function(route){return route=route.replace(escapeRegExp,"\\$&").replace(optionalParam,"(?:$1)?").replace(namedParam,function(match,optional){return optional?match:"([^/?]+)"}).replace(splatParam,"([^?]*?)"),new RegExp("^"+route+"(?:\\?([\\s\\S]*))?$")},Matcher=function(pattern,view){this._re=_routeToRegExp(pattern),this._view=view};return Matcher.prototype.has=function(pattern){var r=this._re.exec(pattern);return r&&r.length>0?!0:!1},Matcher}(),Shifter}();